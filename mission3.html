<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>MindAR: targets.mind → xray.png 오버레이</title>

    <!-- A-Frame & MindAR (Image) -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      html, body { margin: 0; height: 100%; overflow: hidden; background: #000; }
      .btns { position: fixed; z-index: 10; left: 12px; bottom: 12px; display: flex; gap: 8px; }
      .btns button { padding: 8px 12px; border-radius: 8px; border: 0; font-weight: 600; }
      .hint { position: fixed; z-index: 10; right: 12px; bottom: 12px; color: #fff; font: 14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif; opacity: .8; text-align: right; }
      .hint a { color: #fff; text-decoration: underline; }
    </style>
  </head>
  <body>
    <!-- 간단한 컨트롤(선택 사항) -->
    <div class="btns">
      <button id="startBtn">Start</button>
      <button id="stopBtn">Stop</button>
    </div>
    <div class="hint">카메라를 <strong>images/mission3/targets.mind</strong>에 등록된 이미지로 향하면<br>오버레이된 <strong>xray.png</strong>가 나타납니다.</div>

    <!-- AR 씬 -->
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      renderer="colorManagement: true; physicallyCorrectLights: true"
      device-orientation-permission-ui="enabled: true"
      mindar-image="imageTargetSrc: images/mission3/targets.mind">

      <!-- 에셋 프리로드 -->
      <a-assets>
        <!-- 오버레이 이미지 -->
        <img id="xray" src="images/mission3/xray.png" crossorigin="anonymous" />
      </a-assets>

      <!-- 카메라 (MindAR가 제공하는 카메라 사용) -->
      <a-camera position="0 0 0" look-controls-enabled="false"></a-camera>

      <!-- 타깃(첫 번째 인덱스) 위에 xray.png 오버레이 -->
      <a-entity mindar-image-target="targetIndex: 0">
        <!-- width/height는 타깃의 실제 크기 비율에 맞게 조정 (미터 단위). 필요 시 회전/위치 보정 -->
        <a-image src="#xray" width="1" height="1" position="0 0 0" rotation="0 0 0" transparent="true"></a-image>
      </a-entity>

      <!-- 조명(선택 사항) -->
      <a-entity light="type: ambient; intensity: 1.0"></a-entity>
    </a-scene>

    <script>
      // Start/Stop 컨트롤 (선택 사항)
      const sceneEl = document.querySelector('a-scene');
      const startBtn = document.getElementById('startBtn');
      const stopBtn = document.getElementById('stopBtn');

      startBtn?.addEventListener('click', async () => {
        const system = sceneEl?.systems['mindar-image-system'];
        await system?.start();
      });

      stopBtn?.addEventListener('click', async () => {
        const system = sceneEl?.systems['mindar-image-system'];
        await system?.stop();
      });

      // iOS 13+ 권한 요청 대응: 사용자가 상호작용 시 시작
      window.addEventListener('click', async () => {
        try {
          const system = sceneEl?.systems['mindar-image-system'];
          if (system && system.video && system.video.readyState < 2) {
            await system.start();
          }
        } catch (e) {
          // noop
        }
      }, { once: true });
    </script>
  </body>
</html>
